"use strict";(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof module==="object"&&module.exports){module.exports=b()}else{a.IMCache=b()}}})(this,function(){var b={};var c="0";var k={};function r(u){var v=h(u);if(v){return v.value}return null}function i(v,x,u){var w=g(v);b[w]=s(v,x,u);p();if(u.ws){e(u.ws)}}function f(u,x){var v=g(u);var w=b[v];if(w){d(w,x);p()}}function t(u){var v=l(u);v.forEach(function(w){delete b[w]});p()}function m(){b={};c="0"}function h(w){var x=g(w);var y=b[x];if(y){var u=y.options&&y.options.expire;if(u){var v=(new Date()).getTime();u+=y.timestamp;if(v>=u){t(w);return null}}return y}return null}function s(v,w,u){return{key:v,value:w,timestamp:(new Date()).getTime(),options:u,changed:false}}function d(v,u){v.value=u;v.changed=true}function a(){return c}function p(){var u=q(b);c=u}function q(v){function u(A){var x=0;if(A!==null&&A!==undefined){switch(typeof A){case"number":x+=8;break;case"string":x+=A.length*2;break;case"boolean":x+=4;break;default:var y=Object.prototype.toString.call(A).slice(8,-1);if(y==="Object"||y==="Array"){for(var z in A){if(!A.hasOwnProperty(z)){continue}x+=u(z);x+=u(A[z])}}else{x+=A.toString().length*2}break}}return x}function w(x){if(x<1024){return x+" b"}else{if(x<1048576){return(x/1024).toFixed(3)+" KB"}else{if(x<1073741824){return(x/1048576).toFixed(3)+" MB"}}}return(x/1073741824).toFixed(3)+" GB"}return w(u(v))}function j(y){var x=0;if(y.length===0){return x}for(var v=0,u=y.length;v<u;v++){var w=y.charCodeAt(v);x=((x<<5)-x)+w;x|=0}return x}function g(u){return"Key"+j(u)}function o(w){var u=[];for(var v in b){if(b.hasOwnProperty(v)){var x=b[v];if(w.test(x.key)){u.push(v)}}}return u}function l(v){var w=[];var u=[];var x=n(v);switch(x){case"String":u.push(g(v));break;case"RegExp":u=o(v);break;default:u.push(g(v));break}w=w.concat(u);u.forEach(function(y){var z=b[y];if(z&&z.options&&z.options.relatedCacheKeys){z.options.relatedCacheKeys.forEach(function(A){w=w.concat(l(A))})}});return w}function n(u){return Object.prototype.toString.call(u).slice(8,-1)}function e(v){if(!k[v]){try{var u=new WebSocket(v);u.onopen=function(){k[v]=u};u.onerror=function(){};u.onclose=function(){delete k[v]};u.onmessage=function(y){var x=y.data;t(x)}}catch(w){}}}return{get:r,set:i,update:f,remove:t,clear:m,getSize:a}});